import{u as B,l as C,N as O,b as _,r as A,j as s,c as u,o as E,O as M,S as P,B as T,Q as U,p as c,G as z,f as I,V as G,_ as y}from"./index-7cb0f30c.js";import{c as K,i as q,m as H}from"./changePassword-39b3380f.js";import{C as p}from"./Card-dc02554a.js";import{P as N}from"./PasswordInput-5b94bbeb.js";function v(r){return r?r==null?void 0:r.split(" ").map(l=>l.charAt(0).toUpperCase()).slice(0,2).join(""):null}const Q=["teal","violet","blue","pink","green","yellow","red","orange","indigo","cyan","grape","#a436b5","#36b59e","#b56536"],J=()=>{var g;const{md:r}=B(),l=C({mutationFn:K}),i=O({initialValues:{password:"",confirmPassword:""},validate:{password:q("Harap isi password password baru anda"),confirmPassword:H("password","Password tidak sama")}}),{error:R,isError:S,isSuccess:t,data:a}=_({queryFn:G,queryKey:["session-profile"]}),k=n=>{l.mutate(n,{onSuccess:d=>{y.success("Ubah password berhasil!"),i.reset()},onError:d=>{y.error("Gagal mengubah password")}})},F=n=>{var d;k({password:n.password,id:(d=a==null?void 0:a.data)==null?void 0:d.id})},e=t&&((g=a==null?void 0:a.data)==null?void 0:g.student),o=t&&(a==null?void 0:a.data),x=t&&(a==null?void 0:a.data.role_id.role_name)==="User",m=t&&(a==null?void 0:a.data.role_id.role_name)==="Admin",f=o==null?void 0:o.fullname,b=e==null?void 0:e.name,h=v(b),j=v(f),w=A.useMemo(()=>Math.floor(Math.random()*14)+1,[]);return S?s.jsx(u,{size:40,children:"Oops, Terjadi Kesalahan"}):s.jsx(s.Fragment,{children:s.jsxs(E,{title:"Profile",children:[s.jsx(M,{label:"Profile"}),s.jsxs(P,{mt:40,spacing:"2rem",className:"style-box max-w-[70rem] mx-auto",children:[s.jsxs(p,{withBorder:!0,children:[s.jsx(p.Section,{className:"bg-cover bg-no-repeat bg-center",h:150,sx:{background:`url(/profile/${w}.avif)`}}),s.jsxs(p.Section,{py:"1rem",pl:r?"12rem":"0",sx:{display:"flex",position:"relative",justifyContent:r?null:"center"},children:[s.jsx(T,{sx:n=>({position:"absolute",top:-65,left:r?40:null,backgroundColor:n.colorScheme==="dark"?n.colors.dark[6]:n.white,borderRadius:"50%"}),children:s.jsxs(U,{color:Q[w-1],variant:"filled",radius:"50%",size:120,sx:{border:"4px solid transparent"},children:[h||"",j||""]})}),s.jsxs(u,{size:30,fw:700,mt:r?0:40,children:[t&&m?f:"",t&&x?b:""]})]})]}),t&&m?s.jsxs(s.Fragment,{children:[s.jsx(c,{label:"Nama",readOnly:!0,value:o==null?void 0:o.fullname}),s.jsx(c,{label:"No Telepon",readOnly:!0,value:o==null?void 0:o.username})]}):"",t&&x?s.jsxs(s.Fragment,{children:[s.jsx(c,{label:"Nama",readOnly:!0,value:e==null?void 0:e.name}),s.jsx(c,{label:"No Telepon",readOnly:!0,value:e==null?void 0:e.phone})]}):"",m&&s.jsx("form",{onSubmit:i.onSubmit(F),children:s.jsxs(P,{mt:30,children:[s.jsx(u,{mt:20,fz:30,fw:600,children:"Ubah Password"}),s.jsx(N,{label:"Password Baru",...i.getInputProps("password")}),s.jsx(N,{label:"Konfirmasi Password",...i.getInputProps("confirmPassword")}),s.jsx(z,{position:"right",mt:20,children:s.jsx(I,{type:"submit",loading:l.status==="pending",children:"Ubah Password"})})]})})]})]})})};export{J as default};
