import{k as b,d as se,e as ne,m as re,aO as L,aj as oe,r as $,aA as le,b as S,l as G,j as a,L as q,A as ce,o as ie,O as de,S as N,bM as ue,c as r,P as O,B as p,$ as m,T as he,G as z,f as k,aI as ge,_ as h}from"./index-9681aaed.js";import{D as pe,c as xe}from"./DataTable-eb9624a9.js";import{s as me}from"./statusValue-1ba5fc7f.js";import{B as be}from"./Badge-6cfb110d.js";import{c as je}from"./createReactComponent-c44e580f.js";import"./Flex-0563204e.js";import"./Select-3c957265.js";import"./Card-682de79b.js";var ye=je("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const we=async s=>(await b.get("/v1/admin/registration-batch/get?id="+s)).data,fe=async s=>{se.get(ne+"/public/get-student-to-excel?batchId="+s,{responseType:"blob"}).then(n=>{n.headers["Content-Disposition"];const x=window.URL.createObjectURL(new Blob([n.data])),i=document.createElement("a");i.href=x,i.setAttribute("download","student_data.xls"),document.body.appendChild(i),i.click()}).catch(n=>{console.error("Gagal mengunduh file Excel:",n)})},Se=async s=>(await b.get(`/v1/admin/registration-batch/get-students?batchId=${s}&page=0&size=1000`)).data,ke=async s=>(await b.get("/v1/admin/registration-batch/count-data?batchId="+s)).data,_e=async s=>(await b.delete("/v1/admin/registration-batch/delete-student-from-batch?studentId="+s)).data,Pe=()=>{var D,M,C,I,E,F,P,T;const s=re(),{gelombangId:n}=L(),{tipeGelombang:x}=L(),i=oe(),[R,H]=$.useState(""),[K,{close:j,open:V}]=le(),[g,_]=$.useState(null),{data:d,isLoading:y}=S({queryKey:["get_total_pendaftar_batch"],queryFn:()=>ke(n)}),Q=G({mutationFn:fe}),B=G({mutationFn:_e}),U=e=>{Q.mutate(e,{onSuccess:t=>{h.success("Success")},onError:t=>h.error("Gagal")})},{data:o,isFetching:v,isError:J,error:W}=S({queryKey:["get_all_student_by_batch_id"],queryFn:()=>Se(n)}),{data:u,isLoading:X}=S({queryKey:["get_gelombang_by_id"],queryFn:()=>we(n)}),Y=()=>{g.id&&B.mutate(g.id,{onSuccess:e=>{const t=e==null?void 0:e.message;if(i.invalidateQueries({queryKey:["get_all_student_by_batch_id"]}),j(),t){h.success(t);return}h.success("Success")},onError:e=>{var l,A;const t=(A=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:A.messages;if(t){h.error(t);return}h.error("Data gagal dihapus")}})},Z=(D=o==null?void 0:o.data)==null?void 0:D.totalElements,ee=(M=o==null?void 0:o.data)==null?void 0:M.totalPages,w=(I=(C=o==null?void 0:o.data)==null?void 0:C.content)==null?void 0:I.map(e=>({id:(e==null?void 0:e.id)??1,nama:(e==null?void 0:e.name)??"-",noWa:(e==null?void 0:e.phone)??"-",status:(e==null?void 0:e.status)??null,tanggalMendaftar:(e==null?void 0:e.registration_Date)??null})),f=w==null?void 0:w.filter(e=>e),ae=f==null?void 0:f.filter(e=>e.nama.toLowerCase().includes(R.toLowerCase())),c=xe(),te=[c.accessor(e=>e.id,{id:"Id",cell:e=>e.row.index+1,header:()=>a.jsx("span",{children:"ID"})}),c.accessor(e=>e.nama,{id:"Nama",cell:e=>a.jsx("span",{style:{whiteSpace:"nowrap"},children:e.getValue()}),header:()=>a.jsx("span",{children:"Nama"})}),c.accessor(e=>e.noWa,{id:"No Telepon",cell:e=>e.getValue(),header:()=>a.jsx("span",{children:"No. Telepon"})}),c.accessor(e=>e.tanggalMendaftar,{id:"Tanggal Mendaftar",cell:e=>{const t=e.getValue(),l=t&&new Date(t);return t?l.toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}):"-"},header:()=>a.jsx("span",{style:{whiteSpace:"nowrap"},children:"Tanggal Mendaftar"})}),c.accessor(e=>e.status,{id:"Status",cell:e=>{const t=e.getValue(),l=me[t];return l?a.jsx(be,{size:"lg",color:l.color,bg:!s&&"#dcfce2",children:l.value}):"-"},header:()=>a.jsx("span",{style:{whiteSpace:"nowrap"},children:"Status"})}),c.display({id:"Detail",cell:e=>{const t=e.row.original.id;return a.jsx(q,{to:`/ppdb/main/pendaftar-ppdb/${x}/${n}/${t}`,className:"bg-blue-600 px-4 py-[3px] no-underline text-white rounded-full font-bold",children:"Detail"})},header:()=>a.jsx("span",{children:"Detail"})}),c.display({id:"Aksi",cell:e=>{const t=e.row.original;return a.jsx(ce,{color:"red",variant:"filled",onClick:()=>{t!=null&&t.id&&(t!=null&&t.nama)&&(V(),_({id:t==null?void 0:t.id,name:t==null?void 0:t.nama}))},children:a.jsx(ye,{})})},header:()=>a.jsx("span",{children:"Aksi"})})];return a.jsxs(ie,{title:"Seleksi Gelombang",children:[a.jsx(de,{label:"Seleksi Gelombang"}),a.jsxs(N,{mt:20,children:[!v&&a.jsxs(q,{to:`/ppdb/main/pendaftar-ppdb/${x}`,className:"text-xl no-underline font-bold  flex  items-center gap-2 w-fit cursor-pointer",children:[a.jsx(ue,{color:`${s?"#9b87de":"#2A166F"}`}),a.jsx(r,{color:`${s?"#9b87de":"#2A166F"}`,children:"Kembali"})]}),a.jsxs(O,{withBorder:!0,p:"md",radius:"md",bg:"linear-gradient(to left bottom, #6952ba, #160942)",children:[a.jsx(p,{children:X?a.jsx(m,{height:35,w:400}):a.jsx(he,{c:"white",order:2,children:(E=u==null?void 0:u.data)==null?void 0:E.name})}),a.jsxs(p,{bg:`${s?"#1A1B1E":"#FFFFFF"}`,sx:{padding:"0.5rem 1.5rem",marginTop:"1rem",display:"flex",gap:"2rem",borderRadius:"10px"},children:[a.jsxs(p,{children:[a.jsx(r,{weight:"bold",align:"center",children:"Jumlah Pendaftar"}),y?a.jsx(m,{height:30}):a.jsxs(r,{c:`${s?"white":"black"}`,weight:"bold",size:"xl",align:"center",children:[(F=d==null?void 0:d.data)==null?void 0:F.totalStudents," Orang"]})]}),a.jsxs(p,{children:[a.jsx(r,{weight:"bold",align:"center",children:"Jumlah Penerimaan"}),y?a.jsx(m,{height:30}):a.jsxs(r,{c:`${s?"white":"black"}`,weight:"bold",size:"xl",align:"center",children:[(P=u==null?void 0:u.data)==null?void 0:P.max_quota," Orang"]})]}),a.jsxs(p,{children:[a.jsx(r,{weight:"bold",align:"center",children:"Peserta Diterima"}),y?a.jsx(m,{height:30}):a.jsxs(r,{c:`${s?"white":"black"}`,weight:"bold",size:"xl",align:"center",children:[(T=d==null?void 0:d.data)==null?void 0:T.studentAccepted," Orang"]})]})]})]}),a.jsxs(O,{withBorder:!0,p:"md",radius:"md",children:[a.jsxs(z,{mb:20,children:[a.jsx(r,{sx:{flex:1},size:"lg",weight:500,mb:10,children:"Data Pendaftar"}),a.jsx(k,{onClick:()=>U(n),children:"Export Excel"})]}),J?a.jsx(r,{children:W.message}):a.jsx(pe,{data:ae,canExpand:()=>!0,columns:te,loading:v,useSearchInput:!0,noCard:!0,usePagination:!1,onSearch:e=>H(e.toLowerCase()),totalRecords:Z,pagination:{pageIndex:0,pageSize:1e3},pageCount:ee})]})]}),a.jsx(ge,{centered:!0,closeOnClickOutside:!1,closeOnEscape:!1,withCloseButton:!1,opened:K,onClose:()=>{j(),_(null)},title:a.jsx(r,{fz:25,fw:600,children:"Hapus Pendaftar"}),children:a.jsxs(N,{children:[a.jsxs(r,{children:["Anda yakin ingin menghapus pendaftar ",g==null?void 0:g.name]}),a.jsxs(z,{position:"right",children:[a.jsx(k,{variant:"outline",onClick:j,children:"Batal"}),a.jsx(k,{color:"red",type:"button",loading:B.status==="pending",onClick:()=>Y(),children:"Hapus"})]})]})})]})};export{Pe as default};
