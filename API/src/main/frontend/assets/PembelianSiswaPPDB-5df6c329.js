import{r as g,d as j,aa as k,q as P,j as e,B as I,S,v as C,h as F,I as y,_ as m,Q as _,e as v,g as E,t as w,ab as B,D as M,ac as T,ad as A,ae as L,af as R}from"./index-25fc8057.js";import{u as $,g as q,c as N,S as Q,a as D,b as f,d as K,T as G,e as J,F as O,f as z,h as W,i as H}from"./StepCetakKartu-8e4e0176.js";import{R as V}from"./ResponseError-cf042987.js";import"./DataTable-c63220a7.js";import"./Card-b53f8c6e.js";import"./LoadingOverlay-f52f64e8.js";import"./FormWrapper-7b64f918.js";const X=({type:n="PEMBELIAN"})=>{var u,t;const a=$({step:3,stagingId:null}),[o,x]=g.useState(null),{data:r,isSuccess:l}=j({queryKey:["student_staging_offset",a.stagingId,n],queryFn:()=>q(a.stagingId,n),enabled:!!a.stagingId}),c=k(),d=P({mutationFn:N}),p=()=>{const s=()=>{d.mutate({type:n,major:o,stagingId:a.stagingId},{onSuccess:()=>{m.success("Sukses upload bukti bayar"),c.invalidateQueries({queryKey:["get_last_offset_batch"]})},onError:b=>V(b)})},i=()=>console.log("cancel");o==""||!o?m.error("Wajib pilih salah satu jurusan"):_.openContextModal({modal:"createInformasi",innerProps:{onAccept:s,onCancel:i,modalBody:"Anda yakin ingin memilih jurusan ini ?"}})};return g.useEffect(()=>{l&&r.data.major&&x(r.data.major.value)},[l,r]),e.jsxs(I,{sx:s=>({backgroundColor:`${s.colorScheme==="dark"?s.colors.dark[7]:s.white}`,padding:"2rem",boxShadow:"0 5px 10px -8px black",borderRadius:"7px"}),children:[e.jsxs(S,{children:[e.jsx(C,{children:"Pilih Jurusan"}),l&&((u=r.data.current_state)==null?void 0:u.status)==="WAITING_PAYMENT"&&((t=r.data.current_state)==null?void 0:t.type)===n?e.jsx("p",{children:"Harap menunggu konfirmasi pembayaran terlebih dahulu sebelum memilih jurusan"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{type:"MAJOR",readOnly:!!(l&&r.data.major),onChange:s=>x(s),value:o}),e.jsx(F,{variant:"filled",onClick:p,loading:d.isPending,disabled:!!(l&&r.data.major),children:"Submit"})]})]}),e.jsx(y,{position:"top-center"})]})},Y=n=>e.jsx(T,{unstyled:!0,styles:a=>({tab:{...a.fn.focusStyles(),backgroundColor:a.colorScheme==="dark"?a.colors.dark[6]:a.white,color:a.colorScheme==="dark"?"white":a.colors.gray[9],border:"none",boxShadow:"0 10px 20px -10px rgba(0,0,0,0.2)",cursor:"pointer",fontSize:a.fontSizes.sm,borderRadius:"5px","&:disabled":{cursor:"not-allowed",color:a.colorScheme==="dark"?a.colors.gray[4]:a.colors.gray[8],backgroundColor:a.colorScheme==="dark"?a.colors.dark[6]:a.colors.gray[4]},"&[data-active]":{background:"linear-gradient(45deg, #4c6ef5 0%, #15aabf 100%)",borderColor:a.colors.blue[7],color:a.white,boxShadow:"0 10px 20px -10px rgba(0,0,0,0.5)"}},tabsList:{overflowX:"auto"}}),...n}),h=[{index:1,label:"Pilih Gelombang PPDB",icon:A,content:e.jsx(J,{})},{index:2,label:"Pembelian Formulir Pendaftaran",icon:O,content:e.jsx(z,{})},{index:3,label:"Pilih Jurusan",icon:L,content:e.jsx(X,{})},{index:4,label:"Cetak Kartu Peserta",icon:R,content:e.jsx(W,{})}],na=()=>{var u;const[n,a]=g.useState({step:1,stagingId:null}),{data:o,isLoading:x,isSuccess:r}=j({queryKey:["get_last_offset_batch",n],queryFn:()=>H("PEMBELIAN"),staleTime:0}),l=D(n),c=v(),d=E();g.useEffect(()=>{a(l==null?void 0:l.initialValues)},[l]),g.useEffect(()=>{if(r){const t=o.data.filter(s=>s.is_done===1);if(t.length>0){if(o.data[o.data.length-1].index!==t[t.length-1].index){const s=t[t.length-1].index+1,i={step:s,stagingId:o.data.find(b=>b.index===s).id};a(i),d(`${c.pathname}?${f(i)}`)}}else{const s={step:1,stagingId:o.data.find(i=>i.index===1).id};a(s),d(`${c.pathname}?${f(s)}`)}}},[o,r]);const p=t=>{const s={step:+t,stagingId:o.data.find(i=>i.index===+t).id};d(`${c.pathname}?${f(s)}`)};return e.jsxs(w,{title:"Pembelian",children:[e.jsx(B,{label:"Pembelian"}),e.jsx(S,{className:"style-box",children:e.jsxs(Y,{value:`${n.step}`,onTabChange:p,children:[x&&e.jsx(K,{width:"100%"}),r&&e.jsx(G,{activeTabIndex:+n.step,card:o.data.map((t,s)=>{var i;return{label:t.name,index:t.index,icon:(i=h[s])==null?void 0:i.icon,is_done:t.is_done===1}})}),e.jsx(M,{my:20}),(u=h.find(t=>t.index===n.step))==null?void 0:u.content]})}),e.jsx(y,{position:"top-center",reverseOrder:!1})]})};export{na as default};
