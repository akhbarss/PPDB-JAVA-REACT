import{a5 as N,r as D,a6 as He,a7 as Je,a8 as Qe,a9 as te,R as I,X as Xe,aa as Ze,ab as le,ac as Q,ad as ea,ae as aa,af as ra,a as pe,m as sa,j as e,G as he,t as ta,ag as la,c as B,S as L,_ as M,ah as c,p as P,ai as oe,k as oa,aj as ia,l as na,b as W,V as xe,B as G,T as X,f as da,q as ca,n as ua,o as ma,O as pa,$ as ie,a0 as ha,D as xa,a1 as ga,a2 as ge,ak as fe,a3 as fa,a4 as be}from"./index-e253d264.js";import{F as je}from"./index.esm-df819014.js";import{D as U,I as ba,e as ja,R as _a,f as ka,h as Pa,i as va,u as ya,g as Sa,T as ne,S as _e,b as ke,c as Da,d as Pe,a as Ia}from"./generateQueryParam-d23312ed.js";import{u as ve,C as R,F as Na}from"./FormWrapper-63ce38bf.js";import{H as wa}from"./index.esm-b8b34bcc.js";import{I as de}from"./Image-905c7942.js";import{S as Aa}from"./SimpleGrid-2109c522.js";import{T as Z}from"./Textarea-0577a97a.js";import{R as Ca}from"./ResponseError-9ce66710.js";import{c as E}from"./imageUtils-040c21d1.js";import{L as qa}from"./LoadingOverlay-6549b605.js";import"./DataTable-7a7ddedc.js";import"./Flex-4914fec0.js";import"./Select-d0d7a6fd.js";import"./Card-e842cb8c.js";import"./Badge-379626d7.js";function Ta({date:r,maxDate:t,minDate:a}){return!(r==null||Number.isNaN(r.getTime())||t&&N(r).isAfter(t,"date")||a&&N(r).isBefore(a,"date"))}function Ea(r){const t=new Date(r);return Number.isNaN(t.getTime())||!r?null:t}var La=Object.defineProperty,Ma=Object.defineProperties,Ba=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,ce=(r,t,a)=>t in r?La(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,C=(r,t)=>{for(var a in t||(t={}))ye.call(t,a)&&ce(r,a,t[a]);if(Y)for(var a of Y(t))Se.call(t,a)&&ce(r,a,t[a]);return r},V=(r,t)=>Ma(r,Ba(t)),Fa=(r,t)=>{var a={};for(var i in r)ye.call(r,i)&&t.indexOf(i)<0&&(a[i]=r[i]);if(r!=null&&Y)for(var i of Y(r))t.indexOf(i)<0&&Se.call(r,i)&&(a[i]=r[i]);return a};const Oa={valueFormat:"MMMM D, YYYY",fixOnBlur:!0,preserveTime:!0,size:"sm"},De=D.forwardRef((r,t)=>{const a=He("DateInput",Oa,r),{inputProps:i,wrapperProps:b,value:o,defaultValue:j,onChange:x,clearable:_,clearButtonProps:p,popoverProps:h,getDayProps:u,locale:v,valueFormat:k,dateParser:s,minDate:n,maxDate:d,fixOnBlur:g,onFocus:S,onBlur:l,onClick:f,readOnly:y,name:$,form:Ne,rightSection:we,unstyled:ae,classNames:Ae,styles:Ce,allowDeselect:re,preserveTime:qe,date:Te,defaultDate:Ee,onDateChange:Le}=a,Me=Fa(a,["inputProps","wrapperProps","value","defaultValue","onChange","clearable","clearButtonProps","popoverProps","getDayProps","locale","valueFormat","dateParser","minDate","maxDate","fixOnBlur","onFocus","onBlur","onClick","readOnly","name","form","rightSection","unstyled","classNames","styles","allowDeselect","preserveTime","date","defaultDate","onDateChange"]),{calendarProps:Be,others:Fe}=Je(Me),H=Qe(),Oe=s||(m=>{const w=N(m,k,H.getLocale(v)).toDate();return Number.isNaN(w.getTime())?Ea(m):w}),Re=re!==void 0?re:_,F=m=>m?N(m).locale(H.getLocale(v)).format(k):"",[A,K,z]=te({value:o,defaultValue:j,finalValue:null,onChange:x}),[Ke,J]=te({value:Te,defaultValue:j||Ee,finalValue:null,onChange:Le});D.useEffect(()=>{z&&J(o)},[z,o]);const[ze,q]=D.useState(F(A));D.useEffect(()=>{q(F(A))},[H.getLocale(v)]);const[se,O]=D.useState(!1),Ge=m=>{const w=m.currentTarget.value;if(q(w),w.trim()===""&&_)K(null);else{const T=Oe(w);Ta({date:T,minDate:n,maxDate:d})&&(K(T),J(T))}},Ue=m=>{l==null||l(m),O(!1),g&&q(F(A))},Ve=m=>{S==null||S(m),O(!0)},We=m=>{f==null||f(m),O(!0)},Ye=m=>V(C({},u==null?void 0:u(m)),{selected:N(A).isSame(m,"day"),onClick:()=>{const w=qe?ra(A,m):m,T=_&&Re&&N(A).isSame(m,"day")?null:w;K(T),!z&&q(F(T)),O(!1)}}),$e=we||(_&&A&&!y?I.createElement(Xe,C({variant:"transparent",onMouseDown:m=>m.preventDefault(),tabIndex:-1,onClick:()=>{K(null),!z&&q(""),O(!1)},unstyled:ae},p)):null);return Ze(()=>{o!==void 0&&!se&&q(F(o))},[o]),I.createElement(I.Fragment,null,I.createElement(le.Wrapper,V(C({},b),{__staticSelector:"DateInput"}),I.createElement(Q,C({opened:se,trapFocus:!1,position:"bottom-start",disabled:y,withRoles:!1},h),I.createElement(Q.Target,null,I.createElement(le,V(C(C({"data-dates-input":!0,"data-read-only":y||void 0,autoComplete:"off",ref:t,value:ze,onChange:Ge,onBlur:Ue,onFocus:Ve,onClick:We,readOnly:y,rightSection:$e},i),Fe),{__staticSelector:"DateInput"}))),I.createElement(Q.Dropdown,{onMouseDown:m=>m.preventDefault(),"data-dates-dropdown":!0},I.createElement(ea,V(C({__staticSelector:"DateInput"},Be),{classNames:Ae,styles:Ce,unstyled:ae,__preventFocus:!0,minDate:n,maxDate:d,locale:v,getDayProps:Ye,size:i.size,date:Ke,onDateChange:J}))))),I.createElement(aa,{name:$,form:Ne,value:A,type:"default"}))});De.displayName="@mantine/dates/DateInput";const ee=({onChange:r,onReject:t,onDrop:a,accept:i,multiple:b,value:o,label:j})=>{const x=pe(),_=sa();return e.jsxs(U,{multiple:b,onChange:r,onReject:t,maxSize:3*1024**2,accept:i,onDrop:a,children:[e.jsxs(he,{position:"center",spacing:"xl",style:{minHeight:ta(220),pointerEvents:"none",position:"relative",overflow:"hidden"},children:[e.jsx(U.Accept,{children:e.jsx(la,{size:"3.2rem",color:x.colors[x.primaryColor][x.colorScheme==="dark"?4:6]})}),e.jsx(U.Reject,{children:e.jsx(ba,{size:"3.2rem",color:x.colors.red[x.colorScheme==="dark"?4:6]})}),e.jsx(U.Idle,{children:e.jsx(wa,{size:"3.2rem"})}),e.jsx(B,{sx:{zIndex:9,color:o&&!b?"transparent":_?"white":"black"},children:j}),!b&&o&&(o==null?void 0:o.length)>0&&(o==null?void 0:o.map((p,h)=>{const u=URL.createObjectURL(p);return e.jsx(de,{src:u,width:"80%",sx:{position:"absolute",filter:"brightness(50%)",top:0},imageProps:{onLoad:()=>URL.revokeObjectURL(u)}},h)}))]}),e.jsx(Aa,{cols:4,mt:5,breakpoints:[{maxWidth:"sm",cols:1}],children:b&&o&&i===ja&&(o==null?void 0:o.map((p,h)=>{const u=URL.createObjectURL(p);return e.jsx(de,{src:u,w:20,imageProps:{onLoad:()=>URL.revokeObjectURL(u)}},h)}))})]})},Ra=()=>{var i,b,o,j,x,_,p,h,u,v,k,s,n,d;const{register:r,control:t,formState:{errors:a}}=ve();return e.jsxs(L,{spacing:10,children:[e.jsx(R,{render:({field:{onChange:g,value:S}})=>e.jsx(ee,{children:e.jsx("div",{}),label:"Upload pas Photo 3x4, Max : 5MB (DIBUTUHKAN)",onDrop:l=>{g(l)},accept:{"image/*":[]},value:S,multiple:!1,onChange:l=>{var f;return g(((f=l.target.files)==null?void 0:f[0])??null)},onReject:l=>{l[0].errors[0].code=="file-too-large"&&M.error("Size gambar terlalu besar dari 5MB")}}),name:"profile_picture",control:t,rules:{required:{value:!0,message:"Dibutuhkan"}}}),e.jsx(B,{size:"xs",c:"red",children:(i=a==null?void 0:a.profile_picture)==null?void 0:i.message}),e.jsxs(c,{children:[e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Masukkan NISN",label:"NISN",withAsterisk:!1,placeholder:"Nomor NISN",error:a.nisn&&e.jsx("div",{children:(b=a.nisn)==null?void 0:b.message}),required:!0,...r("nisn",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{disabled:!0,description:"Nomor Whatsapp",label:"Nomor WhatsApp",placeholder:"Nomor Whatsapp",error:a.phone&&e.jsx("div",{children:(o=a.phone)==null?void 0:o.message}),required:!0,...r("phone",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nama Lengkap",label:"Nama Lengkap",placeholder:"Nama Lengkap",error:a.name&&e.jsx("div",{children:(j=a.name)==null?void 0:j.message}),required:!0,...r("name",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nama Panggilan",label:"Nama Panggilan",withAsterisk:!1,placeholder:"Nama Panggilan",error:a.surname&&e.jsx("div",{children:(x=a.surname)==null?void 0:x.message}),required:!0,...r("surname",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(_a,{name:"gender",control:t,label:"Gender",rules:{required:{value:!0,message:"Dibutuhkan"}},description:"Pilih salah satu",children:e.jsxs(he,{mt:"xs",children:[e.jsx(oe,{value:"L",label:"Laki laki"}),e.jsx(oe,{value:"P",label:"Perempuan"})]})})}),e.jsxs(c.Col,{lg:6,sm:12,children:[e.jsx(R,{render:({field:{onChange:g,value:S}})=>e.jsx(ka,{type:"RELIGION",readOnly:!1,label:"Agama",onChange:g,value:S,searchable:!1}),name:"religion",control:t,rules:{required:{value:!0,message:"Dibutuhkan"}}}),e.jsx(B,{c:"red",size:"xs",children:(_=a==null?void 0:a.religion)==null?void 0:_.message})]}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Tempat Lahir",placeholder:"Tempat Lahir",error:a.birth_place&&e.jsx("div",{children:(p=a.birth_place)==null?void 0:p.message}),required:!0,...r("birth_place",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(R,{render:({field:{onChange:g,value:S},fieldState:{error:l}})=>e.jsx(De,{error:l==null?void 0:l.message,value:S,onChange:f=>{const y=new Date(f);g(y)},label:"Tanggal Lahir",placeholder:"Tanggal Lahir",styles:{calendar:{maxWidth:"500px"},calendarHeader:{marginInline:"auto"}}}),name:"birth_date",control:t,rules:{required:{value:!0,message:"Dibutuhkan"}}})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(Z,{label:"Alamat",autosize:!0,minRows:3,placeholder:"Alamat",error:a.address&&e.jsx("div",{children:(h=a.address)==null?void 0:h.message}),required:!0,...r("address",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Provinsi",placeholder:"Provinsi",error:a.province&&e.jsx("div",{children:(u=a.province)==null?void 0:u.message}),required:!0,...r("province",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Kota/Kabupaten",placeholder:"Kota/Kabupaten",error:a.city&&e.jsx("div",{children:(v=a.city)==null?void 0:v.message}),required:!0,...r("city",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Kecamatan",placeholder:"Kecamatan",error:a.district&&e.jsx("div",{children:(k=a.district)==null?void 0:k.message}),required:!0,...r("district",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Kelurahan",placeholder:"Kelurahan",error:a.sub_district&&e.jsx("div",{children:(s=a.sub_district)==null?void 0:s.message}),required:!0,...r("sub_district",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Kode Pos",placeholder:"Kode Pos",withAsterisk:!1,error:a.postal_code&&e.jsx("div",{children:(n=a.postal_code)==null?void 0:n.message}),required:!0,...r("postal_code",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{label:"Asal Sekolah",placeholder:"Asal Sekolah",error:a.school_origin&&e.jsx("div",{children:(d=a.school_origin)==null?void 0:d.message}),required:!0,...r("school_origin",{required:{value:!0,message:"Dibutuhkan"}})})})]})]})},Ka=()=>{var i,b,o,j,x,_,p,h,u,v;pe();const{register:r,control:t,formState:{errors:a}}=ve();return e.jsxs(L,{spacing:10,children:[e.jsxs(c,{children:[e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nama Ayah",label:"Nama Ayah",placeholder:"Nama Ayah",error:a.dad_name&&e.jsx("div",{children:(i=a.dad_name)==null?void 0:i.message}),required:!0,...r("dad_name",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nama Ibu",label:"Nama Ibu",placeholder:"Nama Ibu",error:a.mother_name&&e.jsx("div",{children:(b=a.mother_name)==null?void 0:b.message}),required:!0,...r("mother_name",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Pekerjaan Ayah",label:"Pekerjaan Ayah",withAsterisk:!1,placeholder:"Pekerjaan Ayah",error:a.dad_job&&e.jsx("div",{children:(o=a.dad_job)==null?void 0:o.message}),required:!0,...r("dad_job",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Pekerjaan Ibu",label:"Pekerjaan Ibu",placeholder:"Pekerjaan Ibu",withAsterisk:!1,error:a.mother_job&&e.jsx("div",{children:(j=a.mother_job)==null?void 0:j.message}),required:!0,...r("mother_job",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nomor Telepon Ayah",label:"Nomor Telepon Ayah",placeholder:"Nomor Telepon Ayah",error:a.dad_phone&&e.jsx("div",{children:(x=a.dad_phone)==null?void 0:x.message}),required:!0,...r("dad_phone",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(P,{description:"Nomor Telepon Ibu",label:"Nomor Telepon Ibu",placeholder:"Nomor Telepon Ibu",error:a.mother_phone&&e.jsx("div",{children:(_=a.mother_phone)==null?void 0:_.message}),required:!0,...r("mother_phone",{required:{value:!0,message:"Dibutuhkan"}})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(Z,{label:"Alamat Ayah",autosize:!0,minRows:3,placeholder:"Alamat Ayah",error:a.dad_address&&e.jsx("div",{children:(p=a.dad_address)==null?void 0:p.message}),withAsterisk:!1,required:!0,...r("dad_address",{required:!1})})}),e.jsx(c.Col,{lg:6,sm:12,children:e.jsx(Z,{label:"Alamat Ibu",autosize:!0,minRows:3,placeholder:"Alamat Ibu",error:a.mother_address&&e.jsx("div",{children:(h=a.mother_address)==null?void 0:h.message}),withAsterisk:!1,required:!0,...r("mother_address",{required:!1})})})]}),e.jsx(R,{render:({field:{onChange:k,value:s}})=>e.jsx(ee,{children:e.jsx("div",{}),label:"Upload kartu Keluarga 3x4, Max : 5MB ( WAJIB )",onDrop:n=>{k(n)},value:s,multiple:!1,onChange:n=>{var d;return k(((d=n.target.files)==null?void 0:d[0])??null)},onReject:n=>{n[0].errors[0].code=="file-too-large"&&M.error("Size gambar terlalu besar dari 5MB")}}),name:"family_card",control:t,rules:{required:{value:!0,message:"Dibutuhkan"}}}),e.jsx(B,{size:"xs",c:"red",children:(u=a==null?void 0:a.family_card)==null?void 0:u.message}),e.jsx(R,{render:({field:{onChange:k,value:s}})=>e.jsx(ee,{children:e.jsx("div",{}),label:" Upload akta kelahiran 3x4, Max : 5MB ( WAJIB )",onDrop:n=>{k(n)},value:s,multiple:!1,onChange:n=>{var d;return k(((d=n.target.files)==null?void 0:d[0])??null)},onReject:n=>{n[0].errors[0].code=="file-too-large"&&M.error("Size gambar terlalu besar dari 5MB")}}),rules:{required:{value:!0,message:"Dibutuhkan"}},name:"birth_card",control:t}),e.jsx(B,{size:"xs",c:"red",children:(v=a==null?void 0:a.birth_card)==null?void 0:v.message})]})},za=async r=>(await oa.put("/v1/student/update-bio",r)).data,Ie=({type:r="PENGEMBALIAN"})=>{var v,k;const[t,a]=D.useState(!1),i=Pa({step:3,stagingId:null}),[b,o]=D.useState(null),j=ia(),x=na({mutationFn:za});W({queryKey:["get-session-from-bio"],queryFn:xe});const _=s=>{const n=new FormData;for(const[d,g]of Object.entries(s))g!==null&&(d==="profile_picture"||d==="family_card"||d==="birth_card"?n.append(d,g==null?void 0:g[0]):d==="birth_date"?n.append(d,N(g).format("YYYY-MM-DD")):n.append(d,g));x.mutate(n,{onSuccess:()=>{M.success("Sukses update informasi biodata"),j.invalidateQueries({queryKey:["get_last_offset_batch"]})},onError:d=>Ca(d)})},{data:p,isSuccess:h}=W({queryKey:["student_staging_offset",i.stagingId,r],queryFn:()=>va(i.stagingId,r),enabled:!!i.stagingId}),u=async()=>{var n;const s=(n=p.data)==null?void 0:n.student;if(a(!0),typeof(s==null?void 0:s.profile_picture)=="string")try{s.profile_picture=await E(s.profile_picture),s.birth_card=await E(s.birth_card),s.family_card=await E(s.family_card),o({...s,birth_date:s.birth_date?N(s.birth_date).toDate():null}),a(!1)}catch{a(!1),M.error("Gagal mengambil data biodata, silakan coba lagi")}else if((s==null?void 0:s.profile_picture)===null)o({...s,birth_date:s.birth_date?N(s.birth_date).toDate():null}),a(!1);else try{s.profile_picture=await E(s.profile_picture[0].name),s.birth_card=await E(s.birth_card[0].name),s.family_card=await E(s.family_card[0].name),o({...s,birth_date:s.birth_date?N(s.birth_date).toDate():null}),a(!1)}catch{a(!1),M.error("Gagal mengambil data biodata, silakan coba lagi")}};return D.useEffect(()=>{h&&u()},[h]),e.jsx(Na,{id:"form-biodata",initialValues:b,onSubmit:_,children:h&&((v=p.data.current_state)==null?void 0:v.status)==="WAITING_PAYMENT"&&((k=p.data.current_state)==null?void 0:k.type)===r?e.jsx(G,{sx:s=>({backgroundColor:`${s.colorScheme==="dark"?s.colors.dark[7]:s.white}`,padding:"2rem",boxShadow:"0 5px 10px -8px black",borderRadius:"7px"}),children:e.jsxs(L,{children:[e.jsx(X,{children:"Isi Biodata"}),e.jsx("p",{children:"Harap menunggu konfirmasi pembayaran terlebih dahulu sebelum isi biodata"})]})}):e.jsx(e.Fragment,{children:e.jsxs(G,{pos:"relative",children:[e.jsx(G,{sx:s=>({backgroundColor:`${s.colorScheme==="dark"?s.colors.dark[7]:s.white}`,padding:"2rem",boxShadow:"0 5px 10px -8px black",borderRadius:"7px"}),children:e.jsxs(L,{children:[e.jsx(X,{children:"Isi Biodata"}),e.jsx(Ra,{})]})}),e.jsx(G,{sx:s=>({backgroundColor:`${s.colorScheme==="dark"?s.colors.dark[7]:s.white}`,marginTop:10,padding:"2rem",boxShadow:"0 5px 10px -8px black",borderRadius:"7px"}),children:e.jsxs(L,{children:[e.jsx(X,{children:"Informasi Orang Tua"}),e.jsx(Ka,{}),e.jsx(da,{type:"submit",variant:"filled",loading:x.isPending,children:"Submit"})]})}),e.jsx(qa,{visible:t,zIndex:10})]})})})};function Ga(r){const{grade:t}=r;return e.jsx(ga,{unstyled:!0,styles:a=>({tab:{...a.fn.focusStyles(),backgroundColor:a.colorScheme==="dark"?a.colors.dark[6]:a.white,color:a.colorScheme==="dark"?"white":a.colors.gray[9],border:"0.1625rem solid #dee2e6",boxShadow:"0 10px 20px -10px rgba(0,0,0,0.2)",cursor:"pointer",fontSize:a.fontSizes.sm,borderRadius:"5px","&:disabled":{cursor:"not-allowed",color:a.colorScheme==="dark"?a.colors.gray[4]:a.colors.gray[8],backgroundColor:a.colorScheme==="dark"?a.colors.dark[6]:a.colors.gray[4]},"&[data-active]":{background:`linear-gradient(45deg, ${t=="SMP"&&"#2A166F"||t=="SMK"&&"#FF6C22"}, ${t=="SMP"&&"#6548DB"||t=="SMK"&&"#ff9f22"})`,borderColor:"green",color:a.white,boxShadow:"0 10px 20px -10px rgba(0,0,0,0.5)"}},tabsList:{overflowX:"auto"}}),...r})}const ue=[{index:1,label:"Pilih Jalur PPDB",icon:ge,content:e.jsx(_e,{type:"PENGEMBALIAN"})},{index:2,label:"Transaksi Pengembalian",icon:je,content:e.jsx(ke,{type:"PENGEMBALIAN"})},{index:3,label:"Isi Biodata",icon:fe,content:e.jsx(Ie,{type:"PENGEMBALIAN"})},{index:4,label:"Pilih Jurusan",icon:fa,content:e.jsx(Da,{type:"PENGEMBALIAN"})},{index:5,label:"Cetak Kartu Peserta",icon:be,content:e.jsx(Pe,{type:"PENGEMBALIAN"})}],me=[{index:1,label:"Pilih Jalur PPDB",icon:ge,content:e.jsx(_e,{type:"PENGEMBALIAN"})},{index:2,label:"Transaksi Pengembalian",icon:je,content:e.jsx(ke,{type:"PENGEMBALIAN"})},{index:3,label:"Isi Biodata",icon:fe,content:e.jsx(Ie,{type:"PENGEMBALIAN"})},{index:4,label:"Cetak Kartu Peserta",icon:be,content:e.jsx(Pe,{type:"PENGEMBALIAN"})}],ir=()=>{var v,k,s,n,d,g,S;const[r,t]=D.useState({step:1,stagingId:null}),{data:a,isSuccess:i,isFetching:b}=W({queryKey:["get_last_offset_batch"],queryFn:()=>Ia("PENGEMBALIAN"),staleTime:0,notifyOnChangeProps:"all"}),{data:o}=W({queryFn:xe,queryKey:["session"]}),j=ya(r),x=ca(),_=ua(),p=(k=(v=o==null?void 0:o.data)==null?void 0:v.student)==null?void 0:k.grade;console.log({user:o}),D.useEffect(()=>{t(j==null?void 0:j.initialValues)},[j]),D.useEffect(()=>{if(i){const l=a.data.filter(f=>f.is_done===1);if(l.length>0)if(a.data[a.data.length-1].index!==l[l.length-1].index){const f=l[l.length-1].index+1;h(f.toString())}else h(l[l.length-1].index.toString());else h("1")}},[a,i]);const h=l=>{var y;const f={step:+l,stagingId:(y=a.data.find($=>$.index===+l))==null?void 0:y.id};_(`${x.pathname}?${Sa(f)}`)},u=i&&((s=a==null?void 0:a.data)==null?void 0:s.filter(l=>(l==null?void 0:l.grade)===p));return e.jsxs(ma,{title:"Pengembalian",children:[e.jsx(pa,{label:"Pengembalian"}),e.jsx(L,{className:"style-box max-w-[100rem] mx-auto",children:(d=(n=o==null?void 0:o.data)==null?void 0:n.student)!=null&&d.isPurchasingDone?e.jsxs(Ga,{value:`${r.step}`,onTabChange:h,grade:p,children:[b?e.jsx(ie,{mt:40,width:"100%",height:200,visible:!0}):e.jsx(e.Fragment,{children:i&&e.jsxs(ha,{w:"100%",display:"flex",type:"always",sx:{display:"block"},offsetScrollbars:!0,children:[p=="SMP"&&e.jsx(ne,{activeTabIndex:+r.step,card:u==null?void 0:u.map((l,f)=>{var y;return{label:l.name,index:l.index,icon:(y=me[f])==null?void 0:y.icon,is_done:l.is_done===1}})}),p=="SMK"&&e.jsx(ne,{activeTabIndex:+r.step,card:u==null?void 0:u.map((l,f)=>{var y;return{label:l.name,index:l.index,icon:(y=ue[f])==null?void 0:y.icon,is_done:l.is_done===1}})})]})}),e.jsx(xa,{my:20}),b?e.jsx(ie,{mt:40,width:"100%",height:200,visible:!0}):e.jsxs(e.Fragment,{children:[p=="SMP"&&((g=me.find(l=>l.index===r.step))==null?void 0:g.content),p=="SMK"&&((S=ue.find(l=>l.index===r.step))==null?void 0:S.content)]})]}):e.jsx(e.Fragment,{children:e.jsx(B,{mt:40,align:"center",maw:450,mx:"auto",children:"Anda belum melakukan menyelesaikan step pembelian, mohon selesaikan step pembelian dahulu"})})})]})};export{ir as default};
